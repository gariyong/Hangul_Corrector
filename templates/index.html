<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>한국어 맞춤법 교정기</title>
    <!-- Tailwind CSS CDN 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            background-color: #f4f7f9;
        }
        .container {
            max-width: 900px;
            margin-top: 4rem;
        }
        textarea, #corrected-output {
            min-height: 150px;
            transition: all 0.3s ease;
        }
        #loading-indicator {
            display: none;
        }
        .model-status-ready {
            color: #10B981; /* Green 500 */
        }
        .model-status-not-ready {
            color: #F59E0B; /* Amber 500 */
        }
    </style>
</head>
<body class="p-4">

<div class="container mx-auto p-6 bg-white shadow-xl rounded-2xl" 
     data-model-ready="{% if model_ready %}true{% else %}false{% endif %}">
    
    <h1 class="text-3xl font-bold text-gray-800 mb-2">한국어 맞춤법/문법 오류 분류기</h1>
    <p class="text-gray-500 mb-6">입력 문장의 오류 유형을 분류하고 교정합니다.</p>

    <div class="mb-6 flex items-center space-x-4 p-3 bg-gray-50 rounded-xl">
        <span class="font-semibold text-sm text-gray-700">모델 상태:</span>
        <!-- model_ready 변수는 Flask에서 전달됩니다 -->
        {% if model_ready %}
            <span class="text-sm font-medium model-status-ready">✅ 사용 가능 (학습 완료 또는 로드됨)</span>
        {% else %}
            <span class="text-sm font-medium model-status-not-ready">⚠️ 로드 중 또는 학습 필요 (잠시 후 다시 시도하세요)</span>
        {% endif %}
    </div>

    <!-- 입력 섹션 -->
    <div class="mb-8">
        <label for="input-sentence" class="block text-lg font-medium text-gray-700 mb-2">원문 입력:</label>
        <textarea id="input-sentence" rows="5" placeholder="맞춤법 오류가 있는 한국어 문장을 입력해주세요." 
                  class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"></textarea>
    </div>

    <!-- 버튼 및 로딩 -->
    <div class="flex flex-col sm:flex-row justify-between items-center mb-8">
        <button id="correct-button" 
                class="w-full sm:w-auto px-6 py-3 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 transition duration-150 shadow-lg shadow-blue-200 disabled:opacity-50">
            오류 분석 및 교정 요청
        </button>
        <div id="loading-indicator" class="flex items-center space-x-3 text-blue-600 mt-4 sm:mt-0">
            <svg class="animate-spin h-5 w-5 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>분석 중...</span>
        </div>
    </div>

    <!-- 결과 섹션 -->
    <div class="mb-4">
        <h2 class="text-xl font-semibold text-gray-700 mb-3">분석 결과:</h2>
        
        <div id="corrected-output" class="w-full p-4 bg-gray-100 border border-gray-300 rounded-lg text-gray-800 whitespace-pre-wrap">
            모델의 분석 결과가 여기에 표시됩니다. 문장을 입력하고 버튼을 눌러보세요.
        </div>
    </div>

    <!-- 오류 유형 표시 섹션 -->
    <div class="mt-6">
        <h2 class="text-xl font-semibold text-gray-700 mb-3">분류된 오류 유형:</h2>
        <div id="label-output" class="flex flex-wrap gap-2 p-3 bg-gray-100 border border-gray-300 rounded-lg min-h-[40px]">
            <span class="text-gray-500">분석 후 오류 유형이 여기에 표시됩니다.</span>
        </div>
    </div>
</div>

<script>
    document.getElementById('correct-button').addEventListener('click', async () => {
        const inputSentence = document.getElementById('input-sentence').value.trim();
        const outputDiv = document.getElementById('corrected-output');
        const labelDiv = document.getElementById('label-output');
        const loading = document.getElementById('loading-indicator');
        const button = document.getElementById('correct-button');

        if (!inputSentence) {
            outputDiv.innerHTML = '<span class="text-red-500">문장을 입력해주세요.</span>';
            labelDiv.innerHTML = '<span class="text-red-500">입력 문장이 없습니다.</span>';
            return;
        }

        // 로딩 상태 시작
        loading.style.display = 'flex';
        button.disabled = true;
        outputDiv.textContent = '분석 중...';
        labelDiv.innerHTML = '<span class="text-gray-500">분석 중...</span>';

        try {
            const response = await fetch('/correct', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ sentence: inputSentence })
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();

            // 1. 교정된 문장 출력
            const correctedText = result.corrected_sentence || "교정된 문장이 없습니다.";
            outputDiv.textContent = correctedText;
            
            // 2. 분류된 레이블 출력
            if (result.labels && result.labels.length > 0) {
                labelDiv.innerHTML = result.labels.map(label => 
                    `<span class="bg-blue-100 text-blue-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded-full">${label}</span>`
                ).join('');
            } else {
                labelDiv.innerHTML = '<span class="text-gray-600">오류 유형이 분류되지 않았거나, 문법/맞춤법 오류가 발견되지 않았습니다.</span>';
            }

        } catch (error) {
            console.error('Correction failed:', error);
            outputDiv.textContent = `오류 발생: 서버에서 결과를 가져올 수 없습니다. (${error.message}). 모델 로드 상태를 확인해주세요.`;
            labelDiv.innerHTML = '<span class="text-red-500">분석 오류</span>';
        } finally {
            // 로딩 상태 종료
            loading.style.display = 'none';
            button.disabled = false;
        }
    });


    document.addEventListener('DOMContentLoaded', () => {
        // main-container 요소에서 data-model-ready 속성 값을 읽어옵니다.
        const modelReadyString = document.querySelector('.container').dataset.modelReady;
        // 문자열 'true'를 실제 JavaScript boolean true로 변환합니다.
        const modelReady = modelReadyString === 'true'; 
        const button = document.getElementById('correct-button');
        
        if (!modelReady) {
            button.disabled = true;
            button.textContent = "모델 로드 중... (잠시만 기다려주세요)";
        }
    });
</script>
</body>
</html>